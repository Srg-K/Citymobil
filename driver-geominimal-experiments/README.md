# DriverGeominimal experiments calc

## Что это
Платформа по расчету экспериментов DI Geominimal 

## Требуется иметь установленными
* git
* make
* python 3.8
* python virtualenv (https://virtualenv.pypa.io/en/latest/index.html)

## Как использовать
* Склонируйте репозиторий себе
* Выполните `make .env` - содаст пустой `.env` файл для указания кастомных настроек БД
* Отредактируйте файл `.env` - переопределите в нем необходимые настройки
 (дефолтные настройки находятся в `.env.dist`)
* Выполните `make install` - установятся зависимости
* Выполните `make run` - запуск сегментации


## Описание процесса
Все результаты хранятся в таблице `segmentation.geominimal_experiment_totals` и `segmentation.geominimal_experiment_stats`

Описание полей `geominimal_experiment_stats`:
* created_at – datetime добавления записи
* campaign_id – ID кампании
* split_pair – варианты эксперимента с разделитем `_`. Пример для А и B – `A_B`
* metric – наименование показателя 
* split_0 – значение показателя левого варианта (А для `A_B`) 
* split_1 – значение показателя правого варианта (B для `A_B`)
* lift – изменение выраженное в % по формуле `(B - A) / A`
* pvalue – показатель pvalue
* mde – минимальынй ожидаемый эффект. Считается по набранному количеству водителей
* is_significant – значима ли метрика. Регулируется в `config.CONFIDENCE_LEVEL`
* pvalue_adj – скорректированное pvalue. По-умолчанию используется BH поправка 
* is_significant_adj – значима ли метрика по скорректированному значению pvalue 

Описание полей `geominimal_experiment_totals`:
* Все тоже самое что и в *_stats в транспонированном виде без split_pair (вместо него каждая строка – вариант теста) и без проверки значимости

### Этапы
1. Получение данных 
2. Процессинг и агрегация
3. Прменение бакетизации и t-теста
4. Залив

### Структура
* main.py - основной скрипт пайплайна
* utils.py – конверторы, обработчики, агрегаторы и т.п.
* stat_tests.py - класс со статистическими методами оценки эксперимента
* config.py - конфиг для расчета метрик, константы
* db.py – методы для подключения к бд
* query.py – запросы к бд

